---
import Layout from "@/layouts/RootLayout.astro";
import tags from "@/config/tags.json";
import type { CollectionEntry } from "astro:content";
import { capitalize, cn } from "@/lib/utils";

interface Props {
  title?: string;
  posts: CollectionEntry<"collection">[];
}

const { title = "Collection", posts } = Astro.props;
const { tag } = Astro.params;
---

<Layout title={title}>
  <div class="hero py-10">
    <div class="container">
      <h1 class="font-bold mb-2 text-2xl">Collection</h1>
      <p class="text-sm italic font-serif">
        Here, you will find a collection of posts I've written about things I'm
        learning about.
      </p>
    </div>
  </div>
  <div class="container py-8">
    <nav aria-label="Tags" class="flex flex-wrap gap-2 mb-8">
      <a
        href="/collection"
        class={cn(
          "text-sm font-medium border px-4 py-1 rounded-full bg-element text-neutral-800 dark:text-neutral-200 border-slate-200 dark:border-white/5",
          {
            "bg-primary text-primary-foreground dark:text-primary-foreground":
              !tag,
          }
        )}>All</a
      >
      {
        tags.sort().map((t) => (
          <a
            href={`/collection/tag/${t}`}
            class={cn(
              "text-sm font-medium border px-4 py-1 rounded-full bg-element text-neutral-800 dark:text-neutral-200 border-slate-200 dark:border-white/5",
              {
                "bg-primary text-primary-foreground dark:text-primary-foreground":
                  tag === t,
              }
            )}
          >
            {capitalize(t)}
          </a>
        ))
      }
    </nav>
    {
      posts.length === 0 ? (
        <p class="text-lg font-semibold text-center">Nothing here</p>
      ) : (
        <ul class="grid lg:grid-cols-3 sm:grid-cols-2 gap-8">
          {posts.map(({ data, slug }) => (
            <li class="relative bg-element py-4 px-6 rounded shadow-md shadow-hover dark:shadow-black/40">
              <article>
                <a
                  href={`/collection/${slug}`}
                  class="text-lg font-semibold block font-serif after:absolute after:inset-0"
                >
                  <h3>{data.title}</h3>
                </a>
                <p class="text-xs font-medium mb-4 text-muted-foreground">
                  {data.publishDate.toLocaleDateString()}
                </p>
                <p class="mb-4 text-sm">{data.description}</p>
                <ul class="flex flex-wrap gap-4">
                  {data.tags.sort().map((tag) => (
                    <a
                      href={`/collection/tag/${tag}`}
                      class="text-xs capitalize font-medium px-3 py-1 bg-accent-400/10 hover:bg-accent-400/20 transition-colors text-accent-800 dark:text-accent-200 border-accent-300/20 rounded border relative"
                    >
                      {tag}
                    </a>
                  ))}
                </ul>
              </article>
            </li>
          ))}
        </ul>
      )
    }
  </div>
</Layout>
